## 网络异常处理

直播中，网络异常的情况比我们能意料到的可能会多不少，常见的情况一般有

- 网络环境切换，比如 3G/4G 与 Wi-Fi 环境切换
- 网络不可达，网络断开属于这一类
- 带宽不足，可能触发缓存速度跟不上播放速度

作为开发者我们不能乐观的认为只要是 Wi-Fi 网就是好的，因为即便是 Wi-Fi 也有可能因为运营商下行限制，共享网络带宽等因素导致以上网络异常情况的出现。

为何在直播中要面对这么多的网络异常情况，而在其他上传/下载中很少遇到的，这是因为直播对实时性的要求使得它不得面对这一情况，即无论网络是否抖动，是否能一直良好，直播都要尽可能是可持续，可观看的状态。

对于网络环境的切换，通常需要 App 整体做出调整，不单单是针对直播，所以 `PLPlayerKit` 并未对这一情况做额外的监听，而是需要开发者自己对这些状态做出处理。

### 1. 重连

`PLPlayerKit` 内部不包含重连逻辑。之所以不包含，主要因素是考虑到 App 的业务逻辑场景多样而负责，对于直播重连的次数，时机，间隔都会有不同的需求，而此时应该让开发者自己来决定是否重连，以及尝试重连的次数。

当因为网络异常而触发了播放断开时，会通过 error Delegate 回调触发

```Objective-C
- (void)player:(nonnull PLPlayer *)player stoppedWithError:(nullable NSError *)error;
```

你可以在这个方法内通过重新调用 `-play` 方法来尝试重连。此处建议不要立即重连，而是采用重连间隔加倍的方式，比如共尝试 3 次重连，第一次等待 0.5s, 第二次等待 1s, 第三次等待 2s，这样的方式主要考虑到弱网时网络带宽的缓解需要时间，而加倍重连可以更容易在网络恢复的时候连接，而非在网络已经拥塞时还不断做无用功的重连。
